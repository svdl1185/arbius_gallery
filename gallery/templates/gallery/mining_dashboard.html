{% extends 'gallery/base.html' %}

{% block content %}
<div class="container">
    <!-- Hero Section -->
    <div class="hero-section text-center">
        <h1 class="hero-title">
            <i class="bi bi-cpu"></i> Mining Analytics Dashboard
        </h1>
        <p class="hero-subtitle">
            Comprehensive analytics for Arbius (AIUS) mining operations and network statistics
        </p>
        <div class="mt-3">
            <span class="badge bg-warning text-dark">
                <i class="bi bi-eye-slash"></i> Hidden Dashboard
            </span>
            {% if dune_available %}
            <span class="badge bg-success text-dark ms-2">
                <i class="bi bi-check-circle"></i> Dune Analytics Connected
            </span>
            {% else %}
            <span class="badge bg-info text-dark ms-2">
                <i class="bi bi-info-circle"></i> Task Completion Tracking
            </span>
            {% endif %}
        </div>
    </div>

    <!-- Earnings Info & Fee Structure -->
    <div class="row mb-4">
        <div class="col-12">
            {% if dune_available %}
            <div class="alert alert-success">
                <h5><i class="bi bi-check-circle"></i> Dune Analytics Integration Active!</h5>
                <p class="mb-2">Real earnings data is being fetched from Dune Analytics. This dashboard now shows:</p>
                <ul class="mb-2">
                    <li><strong>Actual AIUS earnings</strong> where available from on-chain data</li>
                    <li><strong>Task completion metrics</strong> from our database</li>
                    <li><strong>Fee structure breakdown</strong> based on Arbius v5</li>
                </ul>
                <p class="mb-0">
                    <strong>Fee Structure:</strong>
                    Automine = {{ earning_info.fee_structure.automine_formula }} | 
                    User Tasks = {{ earning_info.fee_structure.user_task_formula }} | 
                    Treasury = {{ earning_info.fee_structure.treasury_cut }}
                </p>
            </div>
            {% else %}
            <div class="alert alert-info">
                <h5><i class="bi bi-exclamation-triangle"></i> About Miner Earnings & Fee Structure</h5>
                <p class="mb-2">This dashboard tracks <strong>task completions</strong>. For accurate earnings:</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Arbius Fee Structure (v5):</strong></p>
                        <ul class="mb-2">
                            <li><strong>Automine:</strong> {{ earning_info.fee_structure.automine_formula }}</li>
                            <li><strong>User Tasks:</strong> {{ earning_info.fee_structure.user_task_formula }}</li>
                            <li><strong>Treasury:</strong> {{ earning_info.fee_structure.treasury_cut }}</li>
                            <li><strong>Model Fees:</strong> {{ earning_info.fee_structure.model_fees }}</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Earnings Sources:</strong></p>
                        <ul class="mb-2">
                            {% for source in earning_info.sources %}
                            <li>{{ source }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                
                <p class="mb-0">
                    <strong>For accurate earnings data:</strong> 
                    <a href="{{ earning_info.dune_dashboard }}" target="_blank" class="alert-link">
                        <i class="bi bi-external-link"></i> Check the Dune Analytics Dashboard
                    </a>
                </p>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Network Overview -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <h2 class="section-title">
                    <i class="bi bi-graph-up"></i> Network Overview
                </h2>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <div class="stat-number text-primary">{{ total_tasks|floatformat:0 }}</div>
                        <div class="stat-label">Total Tasks Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-success">{{ total_unique_miners }}</div>
                        <div class="stat-label">Active Miners</div>
                    </div>
                    {% if dune_available and total_distributed > 0 %}
                    <div class="stat-item">
                        <div class="stat-number text-warning">{{ total_distributed|floatformat:1 }}</div>
                        <div class="stat-label">
                            AIUS Distributed 
                            <span class="badge bg-success ms-1">Real Data</span>
                        </div>
                    </div>
                    {% endif %}
                    <div class="stat-item">
                        <div class="stat-number text-info">{{ avg_tasks_per_miner|floatformat:1 }}</div>
                        <div class="stat-label">Avg Tasks/Miner</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-secondary">{{ weekly_stats.tasks_this_week }}</div>
                        <div class="stat-label">Tasks (7 Days)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-secondary">{{ monthly_stats.tasks_this_month }}</div>
                        <div class="stat-label">Tasks (30 Days)</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-warning">
                            <a href="{{ earning_info.dune_dashboard }}" target="_blank" class="text-warning text-decoration-none">
                                <i class="bi bi-external-link"></i> Dune
                            </a>
                        </div>
                        <div class="stat-label">Full Analytics</div>
                    </div>
                </div>
                
                <!-- Charts Section -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5 class="chart-title">Daily Mining Activity</h5>
                            <div class="chart-wrapper">
                                <canvas id="dailyMiningChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5 class="chart-title">Hourly Activity (48H)</h5>
                            <div class="chart-wrapper">
                                <canvas id="hourlyMiningChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Top Miners Section -->
    <div class="row mb-5">
        <div class="col-md-6">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-trophy"></i> Top Miners by Volume
                </h3>
                <div class="miner-leaderboard">
                    {% for miner in top_miners_by_volume %}
                    <div class="miner-entry">
                        <div class="miner-rank">{{ forloop.counter }}</div>
                        <div class="miner-info">
                            <div class="miner-name">{{ miner.display_name }}</div>
                            <div class="miner-address">{{ miner.short_address }}</div>
                        </div>
                        <div class="miner-stats">
                            <div class="miner-stat-primary">{{ miner.total_tasks_completed }} tasks</div>
                            <div class="miner-stat-secondary">
                                {% if miner.has_real_data %}
                                    <span class="text-success">{{ miner.earnings_display.amount|floatformat:1 }} AIUS</span>
                                    <span class="badge bg-success ms-1" title="{{ miner.earnings_display.note }}">Real Data</span>
                                {% else %}
                                    <span class="text-muted" title="{{ miner.earnings_display.note }}">
                                        ~{{ miner.earnings_display.amount|floatformat:1 }} AIUS
                                    </span>
                                    <span class="badge bg-secondary ms-1">Estimated</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted">No mining data available yet.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-lightning"></i> Top Miners by Consistency
                </h3>
                <div class="miner-leaderboard">
                    {% for miner in top_miners_by_consistency %}
                    <div class="miner-entry">
                        <div class="miner-rank">{{ forloop.counter }}</div>
                        <div class="miner-info">
                            <div class="miner-name">{{ miner.display_name }}</div>
                            <div class="miner-address">{{ miner.short_address }}</div>
                        </div>
                        <div class="miner-stats">
                            <div class="miner-stat-primary">{{ miner.avg_tasks_per_day|floatformat:1 }}/day</div>
                            <div class="miner-stat-secondary">{{ miner.active_days }} active days</div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted">No consistency data available yet.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- All Miners Table -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-table"></i> All Miners Statistics
                </h3>
                <div class="alert alert-secondary">
                    <small>
                        <i class="bi bi-info-circle"></i> 
                        This table shows task completion metrics only. For actual AIUS earnings, see the 
                        <a href="{{ earning_info.dune_dashboard }}" target="_blank">Dune Analytics Dashboard</a>.
                    </small>
                </div>
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Miner</th>
                                <th>Tasks Completed</th>
                                <th>Earnings Range</th>
                                <th>Active Days</th>
                                <th>Avg Tasks/Day</th>
                                <th>Users Served</th>
                                <th>First Task</th>
                                <th>Last Task</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for miner in miners_stats %}
                            <tr>
                                <td>{{ forloop.counter }}</td>
                                <td>
                                    <div class="miner-cell">
                                        <div class="miner-name">{{ miner.display_name }}</div>
                                        <div class="text-muted small">{{ miner.short_address }}</div>
                                    </div>
                                </td>
                                <td><span class="badge bg-primary">{{ miner.total_tasks_completed }}</span></td>
                                <td>
                                    {% if miner.has_real_data %}
                                        <span class="text-success">{{ miner.earnings_display.amount|floatformat:1 }} AIUS</span>
                                        <span class="badge bg-success ms-1" title="{{ miner.earnings_display.note }}">Real Data</span>
                                    {% else %}
                                        <span class="text-muted" title="{{ miner.earnings_display.note }}">
                                            ~{{ miner.earnings_display.amount|floatformat:1 }} AIUS
                                        </span>
                                        <span class="badge bg-secondary ms-1">Estimated</span>
                                    {% endif %}
                                </td>
                                <td>{{ miner.active_days }}</td>
                                <td>{{ miner.avg_tasks_per_day|floatformat:2 }}</td>
                                <td>{{ miner.unique_submitters_served }}</td>
                                <td>
                                    {% if miner.first_task %}
                                        {{ miner.first_task|date:"M d, Y" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>
                                    {% if miner.last_task %}
                                        {{ miner.last_task|date:"M d, Y" }}
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="9" class="text-center text-muted">No mining data available yet.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    <div class="text-muted small mt-2">
                        {% if dune_available %}
                            Real earnings shown where available from Dune Analytics. Estimates shown for remaining miners based on task completion and fee structure.
                        {% else %}
                            * Earnings are estimated based on task completion and fee structure. For actual earnings, see the 
                            <a href="{{ earning_info.dune_dashboard }}" target="_blank">Dune Analytics Dashboard</a>.
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Mining Activity -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-activity"></i> Recent Mining Activity
                </h3>
                <div class="recent-activity">
                    {% for activity in recent_mining_activity %}
                    <div class="activity-item">
                        <div class="activity-time">
                            {{ activity.timestamp|date:"M d, H:i" }}
                        </div>
                        <div class="activity-content">
                            <div class="activity-main">
                                <strong>{{ activity.miner_display_name }}</strong> completed task 
                                <code>{{ activity.task_id|truncatechars:12 }}</code>
                            </div>
                            <div class="activity-details text-muted">
                                Submitted by {{ activity.submitter_display_name }} • 
                                Model: {{ activity.model_id|truncatechars:12 }}
                                {% if activity.prompt %}
                                    • "{{ activity.clean_prompt|truncatechars:50 }}"
                                {% endif %}
                            </div>
                        </div>
                        <div class="activity-reward">
                            <span class="badge bg-info" title="Actual reward depends on multiple factors">
                                Variable AIUS
                            </span>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-muted">No recent mining activity found.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

    <!-- Mining by Model -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-diagram-3"></i> Mining Distribution by Model
                </h3>
                <div class="table-responsive">
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th>Model ID</th>
                                <th>Total Tasks</th>
                                <th>Unique Miners</th>
                                <th>Avg Tasks/Miner</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for model in mining_by_model %}
                            <tr>
                                <td>
                                    <code>{{ model.model_id|truncatechars:20 }}</code>
                                </td>
                                <td><span class="badge bg-primary">{{ model.total_tasks }}</span></td>
                                <td><span class="badge bg-info">{{ model.unique_miners }}</span></td>
                                <td>{{ model.avg_tasks_per_miner|floatformat:1 }}</td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" class="text-center text-muted">No model data available yet.</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- AIUS Token Sales & Profit Analysis -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="info-card">
                <h2 class="section-title">
                    <i class="bi bi-currency-dollar"></i> AIUS Token Sales & Miner Profits
                </h2>
                <div class="alert alert-warning">
                    <h5><i class="bi bi-graph-up"></i> Market Analysis & Profit Scenarios</h5>
                    <p class="mb-0">
                        Analysis of AIUS token trading activity and potential miner profits based on different selling strategies.
                        Data sourced from CoinMarketCap, DEX aggregators, and on-chain analytics.
                    </p>
                </div>
                
                <!-- Current Market Overview -->
                <div class="row mb-4">
                    <div class="col-md-8">
                        <h4 class="mb-3"><i class="bi bi-graph-up-arrow"></i> Current Market Status</h4>
                        <div class="stats-grid-compact">
                            <div class="stat-item">
                                <div class="stat-number text-success">${{ token_sales_analysis.current_market.price_usd }}</div>
                                <div class="stat-label">Current Price (USD)</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number text-primary">${{ token_sales_analysis.current_market.market_cap|floatformat:0 }}</div>
                                <div class="stat-label">Market Cap</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number text-info">{{ token_sales_analysis.current_market.circulating_supply|floatformat:0 }}</div>
                                <div class="stat-label">Circulating Supply</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number text-warning">${{ token_sales_analysis.current_market.daily_volume|floatformat:0 }}</div>
                                <div class="stat-label">24h Volume</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number text-secondary">{{ token_sales_analysis.current_market.volume_to_mcap_ratio }}%</div>
                                <div class="stat-label">Vol/MCap Ratio</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <h4 class="mb-3"><i class="bi bi-clock-history"></i> Price History</h4>
                        <div class="price-history">
                            <div class="price-item">
                                <span class="price-label">All-Time High:</span>
                                <span class="price-value text-success">${{ token_sales_analysis.price_history.all_time_high }}</span>
                                <small class="text-muted">(Feb 19, 2024)</small>
                            </div>
                            <div class="price-item">
                                <span class="price-label">All-Time Low:</span>
                                <span class="price-value text-danger">${{ token_sales_analysis.price_history.all_time_low }}</span>
                                <small class="text-muted">(May 31, 2025)</small>
                            </div>
                            <div class="price-item">
                                <span class="price-label">From ATH:</span>
                                <span class="price-value text-danger">{{ token_sales_analysis.price_history.current_vs_ath }}%</span>
                            </div>
                            <div class="price-item">
                                <span class="price-label">From ATL:</span>
                                <span class="price-value text-success">+{{ token_sales_analysis.price_history.current_vs_atl }}%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trading Venues -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="mb-3"><i class="bi bi-arrow-left-right"></i> Trading Venues & Liquidity</h4>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped">
                                <thead>
                                    <tr>
                                        <th>Exchange</th>
                                        <th>24h Volume</th>
                                        <th>Price</th>
                                        <th>Market Share</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for venue in token_sales_analysis.trading_venues %}
                                    <tr>
                                        <td>{{ venue.name }}</td>
                                        <td>${{ venue.volume_24h|floatformat:0 }}</td>
                                        <td>${{ venue.price }}</td>
                                        <td>
                                            {% widthratio venue.volume_24h token_sales_analysis.current_market.daily_volume 100 %}%
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-info mt-3">
                            <small>
                                <i class="bi bi-info-circle"></i>
                                <strong>{{ token_sales_analysis.liquidity_analysis.decentralized_dominance }}%</strong> of trading happens on DEXs. 
                                {{ token_sales_analysis.liquidity_analysis.note }}
                            </small>
                        </div>
                    </div>
                </div>

                <!-- Miner Profit Scenarios -->
                <div class="row mb-4">
                    <div class="col-12">
                        <h4 class="mb-3"><i class="bi bi-calculator"></i> Miner Profit Scenarios</h4>
                        <div class="row">
                            <div class="col-md-4">
                                <div class="scenario-card bg-success bg-opacity-10 border border-success">
                                    <h5 class="text-success">
                                        <i class="bi bi-trophy"></i> Early Bird (Sold at ATH)
                                    </h5>
                                    <p class="scenario-description">{{ token_sales_analysis.miner_scenarios.early_miner_ath.description }}</p>
                                    <div class="scenario-stats">
                                        <div class="scenario-stat">
                                            <span class="stat-label">1,000 AIUS Value:</span>
                                            <span class="stat-value text-success">${{ token_sales_analysis.miner_scenarios.early_miner_ath.earnings_1000_aius|floatformat:0 }}</span>
                                        </div>
                                        <div class="scenario-stat">
                                            <span class="stat-label">vs Current Price:</span>
                                            <span class="stat-value text-success">{{ token_sales_analysis.miner_scenarios.early_miner_ath.vs_current_price }}x higher</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="scenario-card bg-primary bg-opacity-10 border border-primary">
                                    <h5 class="text-primary">
                                        <i class="bi bi-hand-thumbs-up"></i> Current Holder
                                    </h5>
                                    <p class="scenario-description">{{ token_sales_analysis.miner_scenarios.current_holder.description }}</p>
                                    <div class="scenario-stats">
                                        <div class="scenario-stat">
                                            <span class="stat-label">1,000 AIUS Value:</span>
                                            <span class="stat-value text-primary">${{ token_sales_analysis.miner_scenarios.current_holder.earnings_1000_aius|floatformat:0 }}</span>
                                        </div>
                                        <div class="scenario-stat">
                                            <span class="stat-label">If ATH Returns:</span>
                                            <span class="stat-value text-warning">${{ token_sales_analysis.miner_scenarios.current_holder.potential_if_ath_returns|floatformat:0 }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="scenario-card bg-warning bg-opacity-10 border border-warning">
                                    <h5 class="text-warning">
                                        <i class="bi bi-graph-up"></i> DCA Seller
                                    </h5>
                                    <p class="scenario-description">{{ token_sales_analysis.miner_scenarios.dca_seller.description }}</p>
                                    <div class="scenario-stats">
                                        <div class="scenario-stat">
                                            <span class="stat-label">1,000 AIUS Value:</span>
                                            <span class="stat-value text-warning">${{ token_sales_analysis.miner_scenarios.dca_seller.earnings_1000_aius|floatformat:0 }}</span>
                                        </div>
                                        <div class="scenario-stat">
                                            <span class="stat-label">Avg Price:</span>
                                            <span class="stat-value text-warning">${{ token_sales_analysis.miner_scenarios.dca_seller.avg_price_estimate|floatformat:0 }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Individual Miner Profit Analysis -->
                <div class="row">
                    <div class="col-12">
                        <h4 class="mb-3"><i class="bi bi-person-check"></i> Top Miners: Estimated Profit Analysis</h4>
                        <div class="table-responsive">
                            <table class="table table-dark table-striped">
                                <thead>
                                    <tr>
                                        <th>Miner</th>
                                        <th>Est. AIUS Earned</th>
                                        <th>If Sold at ATH</th>
                                        <th>If Selling Now</th>
                                        <th>If DCA Selling</th>
                                        <th>Best Strategy</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for miner in top_miners_by_volume|slice:":10" %}
                                    <tr>
                                        <td>
                                            <div class="miner-cell">
                                                <div class="miner-name">{{ miner.display_name }}</div>
                                                <div class="text-muted small">{{ miner.short_address }}</div>
                                            </div>
                                        </td>
                                        <td>
                                            <span class="badge bg-info">
                                                {% if miner.has_real_data %}
                                                    {{ miner.actual_earnings|floatformat:0 }}
                                                {% else %}
                                                    ~{{ miner.estimated_earnings|floatformat:0 }}
                                                {% endif %}
                                                AIUS
                                            </span>
                                        </td>
                                        <td>
                                            <span class="text-success">
                                                ${{ miner.profit_scenarios.if_sold_at_ath.total_usd|floatformat:0 }}
                                            </span>
                                            <small class="text-muted d-block">
                                                ({{ miner.profit_scenarios.if_sold_at_ath.profit_multiple }}x current)
                                            </small>
                                        </td>
                                        <td>
                                            <span class="text-primary">
                                                ${{ miner.profit_scenarios.if_selling_now.total_usd|floatformat:0 }}
                                            </span>
                                            <small class="text-danger d-block">
                                                ({{ miner.profit_scenarios.if_selling_now.vs_ath_loss }}% vs ATH)
                                            </small>
                                        </td>
                                        <td>
                                            <span class="text-warning">
                                                ${{ miner.profit_scenarios.if_dca_selling.total_usd|floatformat:0 }}
                                            </span>
                                            <small class="text-muted d-block">
                                                (avg ${{ miner.profit_scenarios.if_dca_selling.avg_price|floatformat:0 }})
                                            </small>
                                        </td>
                                        <td>
                                            {% if miner.profit_scenarios.if_sold_at_ath.total_usd > miner.profit_scenarios.if_dca_selling.total_usd %}
                                                <span class="badge bg-success">ATH Sale</span>
                                            {% else %}
                                                <span class="badge bg-warning">DCA</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        <div class="alert alert-secondary mt-3">
                            <small>
                                <i class="bi bi-info-circle"></i>
                                <strong>Disclaimer:</strong> These are estimated scenarios based on task completion data and current market prices. 
                                Actual earnings and selling patterns may vary significantly. AIUS earnings depend on multiple factors including 
                                task fees, model fees, automine vs user tasks, and the continuous halving mechanism.
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly/Monthly Comparison -->
    <div class="row mb-5">
        <div class="col-md-6">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-calendar-week"></i> Weekly Mining Stats
                </h3>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <div class="stat-number text-primary">{{ weekly_stats.tasks_this_week }}</div>
                        <div class="stat-label">Tasks Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-success">{{ weekly_stats.unique_miners_this_week }}</div>
                        <div class="stat-label">Active Miners</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-info">{{ weekly_stats.unique_submitters_this_week }}</div>
                        <div class="stat-label">Task Submitters</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="info-card">
                <h3 class="mb-3">
                    <i class="bi bi-calendar-month"></i> Monthly Mining Stats
                </h3>
                <div class="stats-grid-compact">
                    <div class="stat-item">
                        <div class="stat-number text-primary">{{ monthly_stats.tasks_this_month }}</div>
                        <div class="stat-label">Tasks Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-success">{{ monthly_stats.unique_miners_this_month }}</div>
                        <div class="stat-label">Active Miners</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number text-info">{{ monthly_stats.unique_submitters_this_month }}</div>
                        <div class="stat-label">Task Submitters</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.miner-leaderboard {
    max-height: 400px;
    overflow-y: auto;
}

.miner-entry {
    display: flex;
    align-items: center;
    padding: 12px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.miner-rank {
    width: 30px;
    height: 30px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    color: white;
    margin-right: 12px;
    font-size: 14px;
}

.miner-info {
    flex: 1;
    min-width: 0;
}

.miner-name {
    font-weight: 600;
    color: #ffffff;
    margin-bottom: 2px;
}

.miner-address {
    font-size: 12px;
    color: #888;
    font-family: 'Courier New', monospace;
}

.miner-stats {
    text-align: right;
}

.miner-stat-primary {
    font-weight: 600;
    color: #4ade80;
    margin-bottom: 2px;
}

.miner-stat-secondary {
    font-size: 12px;
    color: #888;
}

.miner-cell .miner-name {
    font-weight: 600;
    color: #ffffff;
}

.recent-activity {
    max-height: 500px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: center;
    padding: 12px;
    margin-bottom: 8px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    border-left: 3px solid #4ade80;
}

.activity-time {
    width: 80px;
    font-size: 11px;
    color: #888;
    text-align: center;
    margin-right: 12px;
}

.activity-content {
    flex: 1;
    min-width: 0;
}

.activity-main {
    margin-bottom: 4px;
}

.activity-details {
    font-size: 12px;
}

.activity-reward {
    margin-left: 12px;
}

/* Token Sales & Profit Analysis Styles */
.price-history {
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    padding: 15px;
}

.price-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding: 4px 0;
}

.price-item:last-child {
    margin-bottom: 0;
}

.price-label {
    font-size: 13px;
    color: #ccc;
}

.price-value {
    font-weight: 600;
    font-size: 14px;
}

.scenario-card {
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 15px;
    height: 100%;
}

.scenario-card h5 {
    margin-bottom: 10px;
    font-size: 16px;
}

.scenario-description {
    font-size: 13px;
    color: #ccc;
    margin-bottom: 15px;
}

.scenario-stats {
    margin-top: auto;
}

.scenario-stat {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding: 4px 0;
}

.scenario-stat:last-child {
    margin-bottom: 0;
}

.scenario-stat .stat-label {
    font-size: 12px;
    color: #aaa;
}

.scenario-stat .stat-value {
    font-weight: 600;
    font-size: 14px;
}

.profit-analysis-table {
    font-size: 13px;
}

.profit-analysis-table .miner-cell {
    min-width: 120px;
}

.profit-analysis-table .text-success,
.profit-analysis-table .text-primary,
.profit-analysis-table .text-warning {
    font-weight: 600;
}

.profit-analysis-table small {
    font-size: 11px;
    line-height: 1.2;
}

@media (max-width: 768px) {
    .scenario-card {
        margin-bottom: 20px;
    }
    
    .price-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
    }
    
    .scenario-stat {
        flex-direction: column;
        align-items: flex-start;
        gap: 2px;
    }
}
</style>

<!-- Charts JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Daily Mining Chart
const dailyCtx = document.getElementById('dailyMiningChart').getContext('2d');
new Chart(dailyCtx, {
    type: 'line',
    data: {
        labels: {{ daily_chart_data.labels|safe }},
        datasets: [{
            label: 'Tasks Completed',
            data: {{ daily_chart_data.tasks|safe }},
            borderColor: '#4ade80',
            backgroundColor: 'rgba(74, 222, 128, 0.1)',
            tension: 0.4,
            fill: true
        }, {
            label: 'Active Miners',
            data: {{ daily_chart_data.miners|safe }},
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            tension: 0.4,
            fill: true
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#ffffff' }
            }
        },
        scales: {
            x: {
                ticks: { color: '#888' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
                ticks: { color: '#888' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
        }
    }
});

// Hourly Mining Chart
const hourlyCtx = document.getElementById('hourlyMiningChart').getContext('2d');
new Chart(hourlyCtx, {
    type: 'bar',
    data: {
        labels: {{ hourly_chart_data.labels|safe }},
        datasets: [{
            label: 'Tasks/Hour',
            data: {{ hourly_chart_data.tasks|safe }},
            backgroundColor: 'rgba(74, 222, 128, 0.6)',
            borderColor: '#4ade80',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#ffffff' }
            }
        },
        scales: {
            x: {
                ticks: { 
                    color: '#888',
                    maxRotation: 45
                },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
            },
            y: {
                ticks: { color: '#888' },
                grid: { color: 'rgba(255, 255, 255, 0.1)' }
            }
        }
    }
});
</script>
{% endblock %} 